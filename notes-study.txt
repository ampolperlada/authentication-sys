1ï¸âƒ£ Project Overview
ðŸ”¹ Goal: Build an authentication system with:
âœ… JWT Authentication (Login, Register, Protect Routes)
âœ… Google OAuth Login (Login with Google)
âœ… Role-Based Access Control (Admin/User roles)

ðŸ”¹ Tech Stack:

Backend: Node.js, Express.js, PostgreSQL/MongoDB, JWT, OAuth (Google)
Frontend: React.js (Optional for testing, or use Postman)
Security: bcrypt.js (for password hashing), dotenv (for environment variables)

auth-system/
â”‚â”€â”€ backend/        âœ… (Express.js + JWT + OAuth)
â”‚   â”œâ”€â”€ config/         # Database & Authentication Config
â”‚   â”‚   â”œâ”€â”€ db.js           # PostgreSQL connection
â”‚   â”‚   â”œâ”€â”€ passport.js     # Google OAuth setup
â”‚   â”œâ”€â”€ controllers/    # Handles Register, Login, Google OAuth
â”‚   â”‚   â”œâ”€â”€ authController.js  # Login, Register, Token Generation
â”‚   â”œâ”€â”€ middleware/     # Protect routes using JWT
â”‚   â”‚   â”œâ”€â”€ authMiddleware.js  # JWT Authentication Middleware
â”‚   â”œâ”€â”€ models/         # Database models
â”‚   â”‚   â”œâ”€â”€ user.js         # User model (DB queries)
â”‚   â”œâ”€â”€ routes/         # API routes for authentication
â”‚   â”‚   â”œâ”€â”€ auth.js         # Register/Login API Routes
â”‚   â”‚   â”œâ”€â”€ protected.js    # Secure API Routes (requires JWT)
â”‚   â”œâ”€â”€ .env             # Stores database credentials & API secrets
â”‚   â”œâ”€â”€ index.js         # Main Express.js server file
â”‚   â”œâ”€â”€ package.json     # Dependencies & scripts
â”‚â”€â”€ frontend/       âœ… (React.js for UI - Optional)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # Login, Register Forms
â”‚   â”‚   â”œâ”€â”€ pages/           # Dashboard, Profile, Auth Pages
â”‚   â”‚   â”œâ”€â”€ App.js           # Connects frontend to backend
â”‚   â”œâ”€â”€ package.json      # Dependencies & scripts
â”‚â”€â”€ README.md         # Documentation

ðŸ“Œ What Changed & Why? (STRUCTURE)
âœ… Organized backend/ into meaningful folders:

config/ â†’ Stores DB & authentication configurations
controllers/ â†’ Handles authentication logic
middleware/ â†’ Secures protected routes
models/ â†’ Manages database queries
routes/ â†’ Defines API endpoints
âœ… Added a frontend/ folder (if you want a UI with React.js)

âœ… Kept .env in backend/ to store credentials securely




Backend: Set Up Node.js + Express.js ------------

ðŸ”¹ Step 1: Initialize Project

mkdir auth-system && cd auth-system
mkdir backend && cd backend
npm init -y


ðŸ”¹ Step 2: Install Required Packages
npm install express jsonwebtoken bcryptjs dotenv cors cookie-parser passport passport-google-oauth20 pg

âœ… Package Explanation:
jsonwebtoken â†’ For generating and verifying JWT tokens
bcryptjs â†’ For hashing passwords
passport-google-oauth20 â†’ For Google OAuth authentication
pg â†’ PostgreSQL database support

 Set Up PostgreSQL (User Table) ------------

 ðŸ”¹ Step 1: Create Database & Table

CREATE DATABASE authdb;

\c authdb

CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100),
  email VARCHAR(100) UNIQUE NOT NULL,
  password VARCHAR(255),
  google_id VARCHAR(255) UNIQUE,
  role VARCHAR(50) DEFAULT 'user'
);

 This table stores:

email/password for JWT authentication
google_id for OAuth authentication
role for role-based access


ðŸ“Œ 5ï¸âƒ£ Backend: JWT Authentication (Register/Login)
ðŸ”¹ Step 1: Set Up User Model (models/user.js)
CODE: 
const pool = require("../config/db");
const bcrypt = require("bcryptjs");

const User = {
  findByEmail: async (email) => {
    const result = await pool.query("SELECT * FROM users WHERE email = $1", [email]);
    return result.rows[0];
  },
  createUser: async (name, email, password) => {
    const hashedPassword = await bcrypt.hash(password, 10);
    const result = await pool.query(
      "INSERT INTO users (name, email, password) VALUES ($1, $2, $3) RETURNING *",
      [name, email, hashedPassword]
    );
    return result.rows[0];
  }
};

module.exports = User;

ðŸ”¹ Step 2: Register & Login (controllers/authController.js)
CODE:
const jwt = require("jsonwebtoken");
const User = require("../models/user");

exports.register = async (req, res) => {
  const { name, email, password } = req.body;
  const existingUser = await User.findByEmail(email);
  if (existingUser) return res.status(400).json({ message: "User already exists" });

  const newUser = await User.createUser(name, email, password);
  res.status(201).json({ message: "User registered successfully" });
};

exports.login = async (req, res) => {
  const { email, password } = req.body;
  const user = await User.findByEmail(email);
  if (!user) return res.status(400).json({ message: "Invalid credentials" });

  const isMatch = await bcrypt.compare(password, user.password);
  if (!isMatch) return res.status(400).json({ message: "Invalid credentials" });

  const token = jwt.sign({ id: user.id, email: user.email }, process.env.JWT_SECRET, { expiresIn: "1h" });
  res.json({ token });
};

ðŸ”¹ Step 3: Protect Routes Using JWT (middleware/authMiddleware.js)
const jwt = require("jsonwebtoken");

exports.protect = (req, res, next) => {
  const token = req.headers.authorization;
  if (!token) return res.status(401).json({ message: "Unauthorized" });

  try {
    const decoded = jwt.verify(token.split(" ")[1], process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (err) {
    res.status(401).json({ message: "Invalid token" });
  }
};


ðŸ“Œ 6ï¸âƒ£ Add Google OAuth (Login with Google)
ðŸ”¹ Step 1: Set Up Google OAuth (config/passport.js)

const passport = require("passport");
const GoogleStrategy = require("passport-google-oauth20").Strategy;
const User = require("../models/user");

passport.use(new GoogleStrategy({
  clientID: process.env.GOOGLE_CLIENT_ID,
  clientSecret: process.env.GOOGLE_CLIENT_SECRET,
  callbackURL: "/auth/google/callback"
}, async (accessToken, refreshToken, profile, done) => {
  let user = await User.findByEmail(profile.emails[0].value);
  if (!user) {
    user = await User.createUser(profile.displayName, profile.emails[0].value, null);
  }
  done(null, user);
}));

passport.serializeUser((user, done) => done(null, user.id));
passport.deserializeUser((id, done) => done(null, id));

ðŸ”¹ Step 2: Google Login Route (routes/auth.js)
const express = require("express");
const passport = require("passport");
const router = express.Router();

router.get("/google", passport.authenticate("google", { scope: ["profile", "email"] }));
router.get("/google/callback", passport.authenticate("google", { failureRedirect: "/" }), (req, res) => {
  res.redirect("/dashboard");
});

module.exports = router;

Step 1: Create config/db.js (Database Connection File)
Inside backend/config/, create a new file called db.js and add this code:
const { Pool } = require("pg");
require("dotenv").config();

const pool = new Pool({
  user: process.env.DB_USER,      // PostgreSQL username
  host: process.env.DB_HOST,      // Usually 'localhost'
  database: process.env.DB_NAME,  // Database name
  password: process.env.DB_PASS,  // PostgreSQL password
  port: 5432                      // Default PostgreSQL port
});

module.exports = pool;


Step 2: Update models/user.js to Use db.js
If your models/user.js is missing or using the wrong database connection, update it:


const pool = require("../config/db");  // âœ… This connects to db.js
const bcrypt = require("bcryptjs");

const User = {
  findByEmail: async (email) => {
    const result = await pool.query("SELECT * FROM users WHERE email = $1", [email]);
    return result.rows[0];
  },

  createUser: async (name, email, password) => {
    const hashedPassword = await bcrypt.hash(password, 10);
    const result = await pool.query(
      "INSERT INTO users (name, email, password) VALUES ($1, $2, $3) RETURNING *",
      [name, email, hashedPassword]
    );
    return result.rows[0];
  }
};

module.exports = User;
âœ… Now your user authentication system knows how to talk to PostgreSQL!


Step 3: Add Database Credentials in .env
Inside your backend/ folder, create or update your .env file:

DB_USER=your_db_user
DB_HOST=localhost
DB_NAME=authdb
DB_PASS=your_db_password
DB_PORT=5432
SESSION_SECRET=your_secret_key
JWT_SECRET=your_jwt_secret
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
ðŸ”¹ Replace your_db_user and your_db_password with your actual PostgreSQL credentials.


