1Ô∏è‚É£ Project Overview
üîπ Goal: Build an authentication system with:
‚úÖ JWT Authentication (Login, Register, Protect Routes)
‚úÖ Google OAuth Login (Login with Google)
‚úÖ Role-Based Access Control (Admin/User roles)

üîπ Tech Stack:

Backend: Node.js, Express.js, PostgreSQL/MongoDB, JWT, OAuth (Google)
Frontend: React.js (Optional for testing, or use Postman)
Security: bcrypt.js (for password hashing), dotenv (for environment variables)

auth-system/
‚îÇ‚îÄ‚îÄ backend/        ‚úÖ (Express.js + JWT + OAuth)
‚îÇ   ‚îú‚îÄ‚îÄ config/         # Database & Authentication Config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.js           # PostgreSQL connection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ passport.js     # Google OAuth setup
‚îÇ   ‚îú‚îÄ‚îÄ controllers/    # Handles Register, Login, Google OAuth
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js  # Login, Register, Token Generation
‚îÇ   ‚îú‚îÄ‚îÄ middleware/     # Protect routes using JWT
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authMiddleware.js  # JWT Authentication Middleware
‚îÇ   ‚îú‚îÄ‚îÄ models/         # Database models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.js         # User model (DB queries)
‚îÇ   ‚îú‚îÄ‚îÄ routes/         # API routes for authentication
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js         # Register/Login API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ protected.js    # Secure API Routes (requires JWT)
‚îÇ   ‚îú‚îÄ‚îÄ .env             # Stores database credentials & API secrets
‚îÇ   ‚îú‚îÄ‚îÄ index.js         # Main Express.js server file
‚îÇ   ‚îú‚îÄ‚îÄ package.json     # Dependencies & scripts
‚îÇ‚îÄ‚îÄ frontend/       ‚úÖ (React.js for UI - Optional)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/      # Login, Register Forms
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/           # Dashboard, Profile, Auth Pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.js           # Connects frontend to backend
‚îÇ   ‚îú‚îÄ‚îÄ package.json      # Dependencies & scripts
‚îÇ‚îÄ‚îÄ README.md         # Documentation

üìå What Changed & Why? (STRUCTURE)
‚úÖ Organized backend/ into meaningful folders:

config/ ‚Üí Stores DB & authentication configurations
controllers/ ‚Üí Handles authentication logic
middleware/ ‚Üí Secures protected routes
models/ ‚Üí Manages database queries
routes/ ‚Üí Defines API endpoints
‚úÖ Added a frontend/ folder (if you want a UI with React.js)

‚úÖ Kept .env in backend/ to store credentials securely




Backend: Set Up Node.js + Express.js ------------

üîπ Step 1: Initialize Project

mkdir auth-system && cd auth-system
mkdir backend && cd backend
npm init -y


üîπ Step 2: Install Required Packages
npm install express jsonwebtoken bcryptjs dotenv cors cookie-parser passport passport-google-oauth20 pg

‚úÖ Package Explanation:
jsonwebtoken ‚Üí For generating and verifying JWT tokens
bcryptjs ‚Üí For hashing passwords
passport-google-oauth20 ‚Üí For Google OAuth authentication
pg ‚Üí PostgreSQL database support

 Set Up PostgreSQL (User Table) ------------

 üîπ Step 1: Create Database & Table

CREATE DATABASE authdb;

\c authdb

CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100),
  email VARCHAR(100) UNIQUE NOT NULL,
  password VARCHAR(255),
  google_id VARCHAR(255) UNIQUE,
  role VARCHAR(50) DEFAULT 'user'
);

 This table stores:

email/password for JWT authentication
google_id for OAuth authentication
role for role-based access


üìå 5Ô∏è‚É£ Backend: JWT Authentication (Register/Login)
üîπ Step 1: Set Up User Model (models/user.js)
CODE: 
const pool = require("../config/db");
const bcrypt = require("bcryptjs");

const User = {
  findByEmail: async (email) => {
    const result = await pool.query("SELECT * FROM users WHERE email = $1", [email]);
    return result.rows[0];
  },
  createUser: async (name, email, password) => {
    const hashedPassword = await bcrypt.hash(password, 10);
    const result = await pool.query(
      "INSERT INTO users (name, email, password) VALUES ($1, $2, $3) RETURNING *",
      [name, email, hashedPassword]
    );
    return result.rows[0];
  }
};

module.exports = User;

üîπ Step 2: Register & Login (controllers/authController.js)
CODE:
const jwt = require("jsonwebtoken");
const User = require("../models/user");

exports.register = async (req, res) => {
  const { name, email, password } = req.body;
  const existingUser = await User.findByEmail(email);
  if (existingUser) return res.status(400).json({ message: "User already exists" });

  const newUser = await User.createUser(name, email, password);
  res.status(201).json({ message: "User registered successfully" });
};

exports.login = async (req, res) => {
  const { email, password } = req.body;
  const user = await User.findByEmail(email);
  if (!user) return res.status(400).json({ message: "Invalid credentials" });

  const isMatch = await bcrypt.compare(password, user.password);
  if (!isMatch) return res.status(400).json({ message: "Invalid credentials" });

  const token = jwt.sign({ id: user.id, email: user.email }, process.env.JWT_SECRET, { expiresIn: "1h" });
  res.json({ token });
};

üîπ Step 3: Protect Routes Using JWT (middleware/authMiddleware.js)
const jwt = require("jsonwebtoken");

exports.protect = (req, res, next) => {
  const token = req.headers.authorization;
  if (!token) return res.status(401).json({ message: "Unauthorized" });

  try {
    const decoded = jwt.verify(token.split(" ")[1], process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (err) {
    res.status(401).json({ message: "Invalid token" });
  }
};


üìå 6Ô∏è‚É£ Add Google OAuth (Login with Google)
üîπ Step 1: Set Up Google OAuth (config/passport.js)

const passport = require("passport");
const GoogleStrategy = require("passport-google-oauth20").Strategy;
const User = require("../models/user");

passport.use(new GoogleStrategy({
  clientID: process.env.GOOGLE_CLIENT_ID,
  clientSecret: process.env.GOOGLE_CLIENT_SECRET,
  callbackURL: "/auth/google/callback"
}, async (accessToken, refreshToken, profile, done) => {
  let user = await User.findByEmail(profile.emails[0].value);
  if (!user) {
    user = await User.createUser(profile.displayName, profile.emails[0].value, null);
  }
  done(null, user);
}));

passport.serializeUser((user, done) => done(null, user.id));
passport.deserializeUser((id, done) => done(null, id));

üîπ Step 2: Google Login Route (routes/auth.js)
const express = require("express");
const passport = require("passport");
const router = express.Router();

router.get("/google", passport.authenticate("google", { scope: ["profile", "email"] }));
router.get("/google/callback", passport.authenticate("google", { failureRedirect: "/" }), (req, res) => {
  res.redirect("/dashboard");
});

module.exports = router;

Step 1: Create config/db.js (Database Connection File)
Inside backend/config/, create a new file called db.js and add this code:
const { Pool } = require("pg");
require("dotenv").config();

const pool = new Pool({
  user: process.env.DB_USER,      // PostgreSQL username
  host: process.env.DB_HOST,      // Usually 'localhost'
  database: process.env.DB_NAME,  // Database name
  password: process.env.DB_PASS,  // PostgreSQL password
  port: 5432                      // Default PostgreSQL port
});

module.exports = pool;


Step 2: Update models/user.js to Use db.js
If your models/user.js is missing or using the wrong database connection, update it:


const pool = require("../config/db");  // ‚úÖ This connects to db.js
const bcrypt = require("bcryptjs");

const User = {
  findByEmail: async (email) => {
    const result = await pool.query("SELECT * FROM users WHERE email = $1", [email]);
    return result.rows[0];
  },

  createUser: async (name, email, password) => {
    const hashedPassword = await bcrypt.hash(password, 10);
    const result = await pool.query(
      "INSERT INTO users (name, email, password) VALUES ($1, $2, $3) RETURNING *",
      [name, email, hashedPassword]
    );
    return result.rows[0];
  }
};

module.exports = User;
‚úÖ Now your user authentication system knows how to talk to PostgreSQL!


Step 3: Add Database Credentials in .env
Inside your backend/ folder, create or update your .env file:

DB_USER=your_db_user
DB_HOST=localhost
DB_NAME=authdb
DB_PASS=your_db_password
DB_PORT=5432
SESSION_SECRET=your_secret_key
JWT_SECRET=your_jwt_secret
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
üîπ Replace your_db_user and your_db_password with your actual PostgreSQL credentials.


üöÄ Why is Vite Running on http://127.0.0.1:5173/ Instead of localhost:3000?
Vite uses port 5173 by default, unlike Create React App (3000).
Also, 127.0.0.1 is the same as localhost, just written differently.

‚úÖ How to Change Vite‚Äôs Port to 3000 (Optional)
If you want it to run on http://localhost:3000, do this:

1Ô∏è‚É£ Open vite.config.js in your project root
2Ô∏è‚É£ Modify the config like this:

js
Copy
Edit
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000, // Change Vite's default port to 3000
  }
});
3Ô∏è‚É£ Restart the Vite dev server:

npm run dev
Now, your Vite app will run at http://localhost:3000/ instead of 5173. ‚úÖ